<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ResuMizer App ‚Äì AI Resume Screening Console</title>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="icon"
      href="{{ url_for('static', filename='favicon.ico') }}"
      type="image/x-icon"
    />
  </head>

  <body class="landing-body">
    <!-- NAVBAR -->
    <header class="lm-nav">
      <div class="lm-nav-inner">
        <a href="{{ url_for('landing') }}" class="lm-logo orbitron">
          <span class="lm-logo-dot"></span>
          ResuMizer
        </a>

        <nav class="lm-nav-links">
          <a href="{{ url_for('landing') }}#features">Features</a>
          <a href="{{ url_for('landing') }}#how-it-works">How It Works</a>
          <a href="{{ url_for('landing') }}#maker">About</a>
        </nav>

        <div class="lm-nav-cta">
          <a href="{{ url_for('landing') }}" class="lm-btn lm-btn-ghost">
            ‚¨Ö Back to Landing
          </a>
        </div>
      </div>
    </header>

    <!-- MAIN APP LAYOUT -->
    <main class="lm-main">
      <!-- HEADER / STATUS -->
      <section class="lm-section" style="padding-top: 1.5rem; padding-bottom: 1.5rem;">
        <div class="lm-section-head" style="text-align: left;">
          <h2 class="orbitron" style="font-size: 1.9rem; margin-bottom: 0.4rem;">
            ResuMizer ‚Äì AI Resume Screening Console
          </h2>
          <p style="max-width: 40rem;">
            Upload your resume, get AI-ranked job matches, see missing skills, and rewrite your
            bullets with local GenAI.
          </p>
        </div>

        <div class="status-panel tech-card" style="margin-top: 1rem;">
          <div class="status-left">
            <div class="status-dot online"></div>
            <span class="orbitron">ENGINE STATUS</span>
          </div>
          <div class="status-right">
            <span>Model: <strong>Ready ‚úÖ</strong></span>

            <span>
              Jobs:
              <strong>
                {% if results %}
                  {{ results|length }} matched
                {% else %}
                  Waiting for input
                {% endif %}
              </strong>
            </span>

            {% if feedback_count and feedback_avg %}
            <span>
              Users:
              <strong>
                ‚≠ê {{ '%.1f'|format(feedback_avg) }} ¬∑ {{ feedback_count }}
                review{% if feedback_count > 1 %}s{% endif %}
              </strong>
            </span>
            {% endif %}
          </div>
        </div>
      </section>

      <!-- 2-COLUMN APP GRID -->
      <section class="lm-section" style="padding-top: 0;">
        <div class="app-grid">
          <!-- LEFT PANEL: INPUT + GENAI -->
          <div class="app-left">
            <!-- UPLOAD FORM -->
            <section class="upload-panel tech-card fade-in-up delay-1">
              <h2 class="orbitron panel-title">
                <i class="fas fa-file-upload"></i> Upload Resume
              </h2>

              <form
                method="POST"
                action="{{ url_for('index') }}"
                enctype="multipart/form-data"
              >
                <div class="upload-zone">
                  <input
                    type="file"
                    name="resume_file"
                    accept=".pdf,.docx"
                    required
                  />
                  <div>
                    <p>Drag &amp; drop or click to browse</p>
                    <small>PDF ¬∑ DOCX</small>
                  </div>
                </div>
                <button type="submit" class="neon-button">
                  üîç Analyze Resume
                </button>
              </form>

              {% if resume_score is defined and resume_score is not none %}
              <div class="overall-score-box" style="margin-top: 1.2rem;">
                <h3 class="orbitron" style="font-size: 1.1rem; margin-bottom: 0.4rem;">
                  Overall Resume Score
                </h3>
                <p style="font-size: 1.6rem; font-weight: 700; margin-bottom: 4px;">
                  {{ resume_score }}/100
                </p>
                <p style="font-size: 0.95rem; opacity: 0.9;">{{ score_message }}</p>
              </div>
              {% endif %}
            </section>

            <!-- GENAI RESUME REWRITER -->
            <section class="upload-panel tech-card fade-in-up delay-2">
              <h2 class="orbitron panel-title">
                ‚ú® GenAI Resume Bullet Rewriter
              </h2>

              <form method="POST" action="{{ url_for('rewrite') }}">
                <div
                  class="upload-zone"
                  style="flex-direction: column; align-items: stretch;"
                >
                  <label><strong>Paste any resume line / summary:</strong></label>

                  <textarea
                    name="raw_text"
                    rows="4"
                    required
                    placeholder="Built a machine learning model for prediction..."
                    style="width: 100%; margin-top: 8px;"
                  >{{ rewrite_original or '' }}</textarea>

                  <label style="margin-top: 12px;"
                    ><strong>Target Role (Optional)</strong></label
                  >

                  <input
                    type="text"
                    name="target_role"
                    placeholder="Eg: Data Scientist, ML Engineer"
                    value="{{ rewrite_target_role or '' }}"
                    style="width: 100%; margin-top: 6px;"
                  />
                </div>

                <button type="submit" class="neon-button">
                  üìù Rewrite with AI
                </button>
              </form>

              {% if rewrite_output %}
              <div class="tech-card fade-in-up delay-3" style="margin-top: 14px;">
                <h3 class="orbitron">Rewritten Bullet Points</h3>
                <pre style="white-space: pre-wrap; margin-top: 8px;">
{{ rewrite_output }}
                </pre>
              </div>
              {% endif %}
            </section>

            <!-- FEEDBACK PANEL -->
            <section class="tech-card feedback-panel fade-in-up delay-3">
              <h2 class="orbitron panel-title">üó£Ô∏è Share Your Feedback</h2>
              <p class="feedback-text">
                Help me improve ResuMizer. What worked well? What could be better?
              </p>

              {% if feedback_success %}
              <div class="feedback-success">
                ‚úÖ Thank you for your feedback! It‚Äôs been recorded.
              </div>
              {% endif %}

              <form
                method="POST"
                action="{{ url_for('feedback') }}"
                class="feedback-form"
              >
                <div class="feedback-row">
                  <div class="feedback-field">
                    <label for="rating"><strong>Overall experience</strong></label>
                    <div class="rating-group">
                      <label>
                        <input type="radio" name="rating" value="5" required />
                        <span>‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</span>
                      </label>
                      <label>
                        <input type="radio" name="rating" value="4" />
                        <span>‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</span>
                      </label>
                      <label>
                        <input type="radio" name="rating" value="3" />
                        <span>‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</span>
                      </label>
                      <label>
                        <input type="radio" name="rating" value="2" />
                        <span>‚≠êÔ∏è‚≠êÔ∏è</span>
                      </label>
                      <label>
                        <input type="radio" name="rating" value="1" />
                        <span>‚≠êÔ∏è</span>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="feedback-row">
                  <div class="feedback-field">
                    <label for="comments"><strong>Your thoughts</strong></label>
                    <textarea
                      id="comments"
                      name="comments"
                      rows="3"
                      placeholder="What worked well? What would you like to see improved?"
                      required
                    ></textarea>
                  </div>
                </div>

                <div class="feedback-row">
                  <div class="feedback-field">
                    <label for="email"><strong>Email (optional)</strong></label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      placeholder="If you'd like me to follow up"
                    />
                  </div>
                </div>

                <button type="submit" class="neon-button">
                  üí¨ Submit Feedback
                </button>
              </form>
            </section>
          </div>

          <!-- RIGHT PANEL: RESULTS -->
          <div class="app-right">
            <!-- ERROR MESSAGE -->
            {% if error %}
            <section class="tech-card fade-in-up delay-1">
              ‚ùó {{ error }}
            </section>
            {% endif %}

            {% if results %}
            <section class="results-panel tech-card fade-in-up delay-2">
              <h2 class="orbitron panel-title">
                üß† AI Analysis Results
              </h2>

              <div class="results-status">
                <div><strong>Text Extraction:</strong> ‚úì</div>
                <div><strong>Embeddings:</strong> ‚úì</div>
                <div><strong>Matching:</strong> ‚úì</div>
              </div>

              <div class="match-list">
                {% for job in results %}
                <div
                  class="result-card fade-in-up {% if loop.index == 1 %}best-match-card{% endif %}"
                >
                  <div class="card-header">
                    <div class="title-block">
                      <div class="rank-circle">
                        {% if loop.index == 1 %}
                        ü•á
                        {% elif loop.index == 2 %}
                        ü•à
                        {% elif loop.index == 3 %}
                        ü•â
                        {% else %}
                        {{ loop.index }}
                        {% endif %}
                      </div>
                      <div>
                        <h3 class="job-title">{{ job.title }}</h3>
                        <p class="job-sub">
                          {% if loop.index == 1 %}Best Match{% else %}Job Role{% endif %}
                        </p>
                      </div>
                    </div>

                    <div class="score-block">
                      {% if loop.index == 1 %}
                      <div class="lm-best-pill" style="margin-bottom: 4px;">
                        <i class="fa-solid fa-trophy"></i> Best Match
                      </div>
                      {% endif %}
                      <div class="score">
                        {{ '%.2f'|format(job.score) }}%
                      </div>
                      <div class="score-label">
                        Match Score
                      </div>
                    </div>
                  </div>

                  <p class="job-desc">{{ job.description_snippet }}</p>

                  {% if job.matching_skills %}
                  <p class="recommendation">
                    ‚úÖ Matched Skills:
                    {{ job.matching_skills|join(', ') }}
                  </p>
                  {% endif %}

                  {% if job.missing_skills %}
                  <p class="recommendation">
                    ‚ùå Missing Skills:
                    {{ job.missing_skills[:6]|join(', ') }}
                    {% if job.missing_skills|length > 6 %}...{% endif %}
                  </p>
                  {% endif %}

                  <p class="recommendation">
                    üìä Skill Coverage:
                    <strong>{{ job.skill_coverage }}%</strong>
                  </p>

                  {% if job.suggestions %}
                  <div class="recommendation">
                    üí° <strong>AI Suggestions:</strong>
                    <ul>
                      {% for suggestion in job.suggestions %}
                      <li>{{ suggestion }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            </section>
            {% else %}
            <section class="tech-card fade-in-up delay-2">
              <h3 class="orbitron" style="margin-bottom: 0.4rem;">
                No analysis yet
              </h3>
              <p style="font-size: 0.95rem; color: var(--gray);">
                Upload a resume on the left to see ranked job matches, skill gaps, and
                AI suggestions here.
              </p>
            </section>
            {% endif %}
          </div>
        </div>
      </section>
    </main>

    <!-- SIMPLE LOADING ANIMATION ON FORM SUBMIT -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const forms = document.querySelectorAll("form");

        forms.forEach((form) => {
          form.addEventListener("submit", function () {
            const btn = form.querySelector('button[type="submit"]');
            if (!btn) return;

            if (btn.classList.contains("is-loading")) return;

            btn.classList.add("is-loading");
            btn.dataset.originalText = btn.innerHTML;
            btn.innerHTML =
              '<span class="spinner"></span> Processing...';
          });
        });
      });
    </script>
  </body>
</html>
